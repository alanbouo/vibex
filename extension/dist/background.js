(()=>{const e="https://api.vibx.space/api",t="https://vibx.space";async function n(e,t={},n=1e4){const o=new AbortController,s=setTimeout(()=>o.abort(),n);try{return await fetch(e,{...t,signal:o.signal})}finally{clearTimeout(s)}}async function o(){const t=await a();if(!t)return{authenticated:!1};const o=await async function(){return new Promise(e=>{chrome.storage.local.get(["userInfo"],t=>{e(t.userInfo||null)})})}();try{const s=await n(`${e}/auth/me`,{headers:{Authorization:`Bearer ${t}`}},8e3);if(s.ok){const e=await s.json(),t=e.data?.user||e.user;return t&&c(t),{authenticated:!0,user:t||o}}return i(),chrome.storage.local.remove(["userInfo"]),{authenticated:!1}}catch(e){return console.log("Auth check error:",e.name,e.message),o?{authenticated:!0,user:o,offline:!0}:"AbortError"===e.name?{authenticated:!1,error:"Connection timeout. Is the backend running?"}:{authenticated:!1,error:e.message}}}async function s(){return new Promise(e=>{chrome.storage.local.get(["vibex_posts","vibex_likes","vibex_posts_updated","vibex_likes_updated"],t=>{e({postsCount:(t.vibex_posts||[]).length,likesCount:(t.vibex_likes||[]).length,postsUpdated:t.vibex_posts_updated||null,likesUpdated:t.vibex_likes_updated||null})})})}async function a(){return new Promise(e=>{chrome.storage.local.get(["authToken"],t=>{e(t.authToken||null)})})}function r(e){chrome.storage.local.set({authToken:e})}function i(){chrome.storage.local.remove(["authToken"])}function c(e){e&&chrome.storage.local.set({userInfo:e})}chrome.runtime.onInstalled.addListener(()=>{console.log("Vibex extension v2.0 installed"),chrome.contextMenus.create({id:"vibex-collect",title:"Collect with Vibex",contexts:["page"],documentUrlPatterns:["https://twitter.com/*","https://x.com/*"]}),chrome.contextMenus.create({id:"vibex-writer",title:"Open AI Writer",contexts:["page"],documentUrlPatterns:["https://twitter.com/*","https://x.com/*"]})}),chrome.contextMenus.onClicked.addListener((e,t)=>{"vibex-collect"===e.menuItemId?chrome.tabs.sendMessage(t.id,{action:"collectPosts"}):"vibex-writer"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{action:"openWriter"})}),chrome.commands.onCommand.addListener((e,t)=>{"collect-posts"===e?chrome.tabs.sendMessage(t.id,{action:"collectPosts"}):"open-writer"===e&&chrome.tabs.sendMessage(t.id,{action:"openWriter"})}),chrome.runtime.onMessage.addListener((l,u,h)=>{switch(l.action){case"analyzeProfile":return async function(t){try{const n=await a(),o=await fetch(`${e}/profiles/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({username:t})});if(!o.ok)throw new Error("Failed to analyze profile");return await o.json()}catch(e){return console.error("Profile analysis error:",e),{data:{analytics:{avgEngagement:Math.floor(500*Math.random()),avgLikes:Math.floor(200*Math.random()),avgRetweets:Math.floor(50*Math.random())}}}}}(l.username).then(e=>h({success:!0,data:e})).catch(e=>h({success:!1,error:e.message})),!0;case"generatePost":return async function({topic:t,tone:n,style:o,samplePosts:s}){const r=await a();if(r)try{const a=await fetch(`${e}/ai/generate-post`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({topic:t,tone:n,style:o,samplePosts:s})});if(a.ok){const e=await a.json();return e.text||e.content}}catch(e){console.log("Backend API not available, using local generation")}return function(e,t,n){const o={single:{professional:[`Here's my take on ${e}:\n\nThe key insight is that success comes from consistent action, not perfect conditions.\n\nWhat's your experience with this?`,`${e} - a thread ðŸ§µ\n\nAfter years of experience, I've learned that the fundamentals matter most.\n\nHere's what works:`,`Unpopular opinion about ${e}:\n\nMost people overcomplicate it.\n\nThe truth? Start simple, iterate fast, learn constantly.`],casual:[`Been thinking about ${e} lately...\n\nHonestly? It's simpler than we make it.\n\nJust start. Figure it out as you go. ðŸš€`,`Hot take on ${e}:\n\nWe're all overthinking this.\n\nThe best approach? Just do the thing. Learn. Repeat.`,`${e} hits different when you stop caring what others think.\n\nDo your thing. Trust the process. ðŸ’ª`],humorous:[`Me explaining ${e} to my friends:\n\n"It's like... you know... the thing..."\n\n*proceeds to make zero sense* ðŸ˜‚`,`${e} be like:\n\nExpectation: ðŸ“ˆ\nReality: ðŸ“‰ðŸ“ˆðŸ“‰ðŸ“ˆðŸ“‰ðŸ“ˆ\n\nBut we keep going anyway ðŸ¤·â€â™‚ï¸`,`Nobody:\nAbsolutely nobody:\nMe at 2am: "What if I revolutionize ${e}?" ðŸ¤”`],inspirational:[`${e} taught me something powerful:\n\nEvery setback is a setup for a comeback.\n\nKeep pushing. Your breakthrough is closer than you think. âœ¨`,`The secret to ${e}?\n\nShow up when you don't feel like it.\nLearn when you think you know enough.\nGrow when you want to stay comfortable.\n\nThat's it. That's the whole game.`,`Remember: ${e} isn't about being perfect.\n\nIt's about being persistent.\n\nYour future self will thank you for not giving up today. ðŸŒŸ`],controversial:[`Controversial take on ${e}:\n\n90% of "experts" are just good at marketing.\n\nThe real ones? They're too busy doing the work to post about it.`,`${e} hot take that'll get me cancelled:\n\nMost advice is useless because it comes from people who got lucky once.\n\nFind what works for YOU.`,`Unpopular opinion: ${e} is broken.\n\nNot because of the concept, but because of how we approach it.\n\nTime for a reset.`]},thread:{professional:`ðŸ§µ Thread: Everything I've learned about ${e}\n\n1/ Let's break this down...\n\nAfter [X] years in this space, here are the patterns that actually matter:\n\n2/ First principle: Start with the fundamentals.\n\nMost people skip this. Don't be most people.\n\n3/ Second: Consistency beats intensity.\n\nSmall daily actions compound into massive results.\n\n4/ Third: Learn from failures fast.\n\nEvery mistake is data. Use it.\n\n5/ The meta-lesson?\n\n${e} rewards those who show up, adapt, and persist.\n\nThat's it. Now go execute. ðŸš€`,casual:`ok let's talk about ${e} ðŸ§µ\n\n1/ so here's the thing...\n\neveryone overcomplicates this\n\n2/ the actual secret?\n\njust start. seriously. that's it.\n\n3/ but wait there's more\n\nonce you start, keep going even when it sucks\n\n4/ the people who "make it"?\n\nthey just didn't quit\n\n5/ tldr on ${e}:\n\nstart â†’ keep going â†’ don't quit â†’ profit\n\nyou're welcome ðŸ˜Ž`},hook:{professional:`I spent 5 years learning ${e} the hard way.\n\nHere's what I wish someone told me on day 1:\n\nâ†’ Focus on fundamentals, not hacks\nâ†’ Consistency beats perfection\nâ†’ Learn from every failure\nâ†’ Build systems, not goals\nâ†’ Trust the process\n\nSave this. You'll need it.`,casual:`${e} changed my life.\n\nNot because it's magic.\n\nBut because I finally understood:\n\nâ€¢ Simple > Complex\nâ€¢ Done > Perfect  \nâ€¢ Consistent > Intense\nâ€¢ Learning > Knowing\n\nThat's the whole game. ðŸŽ¯`},story:{professional:`2 years ago, I knew nothing about ${e}.\n\nToday? It's transformed how I work.\n\nHere's the journey:\n\nMonth 1: Complete confusion. Nothing made sense.\n\nMonth 3: First small win. A glimmer of hope.\n\nMonth 6: Patterns emerged. Things clicked.\n\nYear 1: Consistent results. Real confidence.\n\nYear 2: Teaching others. Full circle.\n\nThe lesson? ${e} isn't about talent.\n\nIt's about not quitting when it gets hard.\n\nYour turn. Start today.`,casual:`story time about ${e} ðŸ‘‡\n\nso there i was, completely clueless...\n\nfast forward 6 months:\n\nstill kinda clueless BUT making progress\n\nthe plot twist?\n\neveryone's figuring it out as they go\n\nthere's no secret playbook\n\njust people who keep showing up\n\nbe one of those people ðŸ™Œ`}},s=o[n]||o.single,a=s[t]||s.professional;return Array.isArray(a)?a[Math.floor(Math.random()*a.length)]:a}(t,n,o)}(l.data).then(e=>h({success:!0,text:e})).catch(e=>h({success:!1,error:e.message})),!0;case"dataCollected":m=l.type,p=l.count,chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"Vibex Collection Complete",message:`Successfully collected ${p} ${m}!`}),h({success:!0});break;case"openDashboard":chrome.tabs.create({url:t}),h({success:!0});break;case"syncToBackend":return async function(t){const o=await a();if(console.log("Sync: Token present:",!!o),!o)throw new Error("Not authenticated. Please log in to the Vibex dashboard first.");let s;console.log("Sync: Sending",t.posts?.length||0,"posts and",t.likes?.length||0,"likes");try{s=await n(`${e}/profiles/import-extension-data`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({posts:t.posts||[],likes:t.likes||[]})},3e4)}catch(e){if(console.error("Sync fetch error:",e),"AbortError"===e.name)throw new Error("Sync timeout. Backend may be unavailable.");throw new Error(`Network error: ${e.message}`)}if(console.log("Sync: Response status:",s.status),!s.ok){const e=await s.json().catch(()=>({}));throw console.error("Sync error response:",e),new Error(e.message||`Server error: ${s.status}`)}const r=await s.json();return console.log("Sync: Success!",r),chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"Vibex Sync Complete",message:`Imported ${r.data?.postsImported||0} posts and ${r.data?.likesImported||0} likes!`}),r}(l.data).then(()=>h({success:!0})).catch(e=>h({success:!1,error:e.message})),!0;case"getStorageStats":return s().then(e=>h({success:!0,stats:e})).catch(e=>h({success:!1,error:e.message})),!0;case"checkAuth":return o().then(e=>h({success:!0,...e})).catch(e=>h({success:!1,error:e.message})),!0;case"connectAccount":return async function(){const e=await async function(){try{const e=await chrome.tabs.query({url:`${t}/*`});if(e.length>0){const t=await chrome.scripting.executeScript({target:{tabId:e[0].id},func:()=>{const e=localStorage.getItem("auth-storage");if(e)try{const t=JSON.parse(e);return{token:t.state?.token,user:t.state?.user}}catch(e){return null}return null}});if(t[0]?.result?.token)return r(t[0].result.token),c(t[0].result.user),t[0].result}return null}catch(e){return console.error("Failed to fetch token from dashboard:",e),null}}();if(e&&e.token){const t=await o();if(t.authenticated)return{success:!0,user:e.user||t.user}}return chrome.tabs.create({url:`${t}/login`}),{success:!1,needsLogin:!0,message:"Please log in to Vibex, then click Connect again."}}().then(e=>h(e)).catch(e=>h({success:!1,error:e.message})),!0;case"disconnectAccount":i(),h({success:!0})}var m,p}),self.vibexAPI={getStorageStats:s,getAuthToken:a,saveAuthToken:r,clearAuthToken:i}})();