(()=>{async function e(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e}function t(e){return e&&(e.includes("twitter.com")||e.includes("x.com"))}async function s(){chrome.runtime.sendMessage({action:"getStorageStats"},e=>{if(e&&e.success){const{postsCount:t,likesCount:s,postsUpdated:c,likesUpdated:a}=e.stats;document.getElementById("postsCount").textContent=t,document.getElementById("likesCount").textContent=s,document.getElementById("postsUpdated").textContent=c?n(c):"Not collected",document.getElementById("likesUpdated").textContent=a?n(a):"Not collected",(t>0||s>0)&&o("success",`${t+s} items collected`)}})}function n(e){const t=new Date(e),s=new Date-t,n=Math.floor(s/6e4),o=Math.floor(s/36e5),c=Math.floor(s/864e5);return n<1?"Just now":n<60?`${n}m ago`:o<24?`${o}h ago`:c<7?`${c}d ago`:t.toLocaleDateString()}function o(e,t){const s=document.getElementById("statusBar"),n=document.getElementById("statusText");s.className="status-bar","warning"===e&&s.classList.add("warning"),"error"===e&&s.classList.add("error"),n.textContent=t}async function c(){return new Promise(e=>{chrome.storage.local.get(["vibex_posts","vibex_likes"],t=>{e({posts:t.vibex_posts||[],likes:t.vibex_likes||[]})})})}document.addEventListener("DOMContentLoaded",()=>{s(),document.getElementById("collectPosts").addEventListener("click",async()=>{const s=await e();t(s.url)?!s.url.includes("/status/")&&s.url.split("/").length<=4?(chrome.tabs.sendMessage(s.id,{action:"collectPosts"}),o("success","Collecting posts..."),window.close()):o("warning","Go to your profile page to collect posts"):o("warning","Please navigate to x.com first")}),document.getElementById("collectLikes").addEventListener("click",async()=>{const s=await e();if(t(s.url))if(s.url.includes("/likes"))chrome.tabs.sendMessage(s.id,{action:"collectLikes"}),o("success","Collecting likes..."),window.close();else{const e=function(e){try{const t=new URL(e).pathname.split("/").filter(e=>e);if(t.length>0&&!["home","explore","notifications","messages","search"].includes(t[0]))return t[0]}catch(e){}return null}(s.url);e?(chrome.tabs.update(s.id,{url:`https://x.com/${e}/likes`}),o("success","Navigating to likes page...")):o("warning","Go to your profile/likes page first")}else o("warning","Please navigate to x.com first")}),document.getElementById("openWriter").addEventListener("click",async()=>{const s=await e();t(s.url)?(chrome.tabs.sendMessage(s.id,{action:"openWriter"}),window.close()):o("warning","Please navigate to x.com first")}),document.getElementById("exportData").addEventListener("click",async()=>{const s=await e();t(s.url)?(chrome.tabs.sendMessage(s.id,{action:"exportData"}),window.close()):async function(){const e=await c(),t={exportedAt:(new Date).toISOString(),posts:e.posts,likes:e.likes},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(s);chrome.downloads.download({url:n,filename:`vibex-export-${(new Date).toISOString().split("T")[0]}.json`,saveAs:!0})}()}),document.getElementById("openDashboard").addEventListener("click",()=>{chrome.runtime.sendMessage({action:"openDashboard"})}),document.getElementById("clearData").addEventListener("click",()=>{confirm("Are you sure you want to clear all collected data?")&&chrome.storage.local.remove(["vibex_posts","vibex_likes","vibex_posts_updated","vibex_likes_updated"],()=>{s(),o("success","Data cleared successfully")})}),document.getElementById("openSettings").addEventListener("click",()=>{chrome.tabs.create({url:"http://localhost:3000/settings"})}),document.getElementById("syncBtn").addEventListener("click",async()=>{o("warning","Syncing to cloud...");const e=await c();chrome.runtime.sendMessage({action:"syncToBackend",data:{posts:e.posts,likes:e.likes}},e=>{e&&e.success?o("success","Synced successfully!"):o("error","Sync failed. Check if you're logged in.")})}),document.getElementById("helpLink").addEventListener("click",e=>{e.preventDefault(),chrome.tabs.create({url:"https://github.com/vibex/docs"})}),document.getElementById("feedbackLink").addEventListener("click",e=>{e.preventDefault(),chrome.tabs.create({url:"https://github.com/vibex/feedback"})})})})();